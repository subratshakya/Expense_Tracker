<<<<<<< HEAD
<<<<<<< HEAD
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StreamDescription = void 0;
=======
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StreamDescription = void 0;
const bson_1 = require("../bson");
>>>>>>> 612faa9106d3f31c019c81e2e601cf7d17c60697
const common_1 = require("../sdam/common");
const server_description_1 = require("../sdam/server_description");
const RESPONSE_FIELDS = [
    'minWireVersion',
    'maxWireVersion',
    'maxBsonObjectSize',
    'maxMessageSizeBytes',
    'maxWriteBatchSize',
    'logicalSessionTimeoutMinutes'
];
/** @public */
class StreamDescription {
    constructor(address, options) {
<<<<<<< HEAD
=======
        this.hello = null;
>>>>>>> 612faa9106d3f31c019c81e2e601cf7d17c60697
        this.address = address;
        this.type = common_1.ServerType.Unknown;
        this.minWireVersion = undefined;
        this.maxWireVersion = undefined;
        this.maxBsonObjectSize = 16777216;
        this.maxMessageSizeBytes = 48000000;
        this.maxWriteBatchSize = 100000;
        this.logicalSessionTimeoutMinutes = options?.logicalSessionTimeoutMinutes;
        this.loadBalanced = !!options?.loadBalanced;
        this.compressors =
            options && options.compressors && Array.isArray(options.compressors)
                ? options.compressors
                : [];
<<<<<<< HEAD
=======
        this.serverConnectionId = null;
>>>>>>> 612faa9106d3f31c019c81e2e601cf7d17c60697
    }
    receiveResponse(response) {
        if (response == null) {
            return;
        }
<<<<<<< HEAD
        this.type = (0, server_description_1.parseServerType)(response);
=======
        this.hello = response;
        this.type = (0, server_description_1.parseServerType)(response);
        if ('connectionId' in response) {
            this.serverConnectionId = this.parseServerConnectionID(response.connectionId);
        }
        else {
            this.serverConnectionId = null;
        }
>>>>>>> 612faa9106d3f31c019c81e2e601cf7d17c60697
        for (const field of RESPONSE_FIELDS) {
            if (response[field] != null) {
                this[field] = response[field];
            }
            // testing case
            if ('__nodejs_mock_server__' in response) {
                this.__nodejs_mock_server__ = response['__nodejs_mock_server__'];
            }
        }
        if (response.compression) {
            this.compressor = this.compressors.filter(c => response.compression?.includes(c))[0];
        }
    }
<<<<<<< HEAD
}
exports.StreamDescription = StreamDescription;
//# sourceMappingURL=stream_description.js.map
=======
'use strict';
const parseServerType = require('../core/sdam/server_description').parseServerType;

const RESPONSE_FIELDS = [
  'minWireVersion',
  'maxWireVersion',
  'maxBsonObjectSize',
  'maxMessageSizeBytes',
  'maxWriteBatchSize',
  '__nodejs_mock_server__'
];

class StreamDescription {
  constructor(address, options) {
    this.address = address;
    this.type = parseServerType(null);
    this.minWireVersion = undefined;
    this.maxWireVersion = undefined;
    this.maxBsonObjectSize = 16777216;
    this.maxMessageSizeBytes = 48000000;
    this.maxWriteBatchSize = 100000;
    this.compressors =
      options && options.compression && Array.isArray(options.compression.compressors)
        ? options.compression.compressors
        : [];
  }

  receiveResponse(response) {
    this.type = parseServerType(response);

    RESPONSE_FIELDS.forEach(field => {
      if (typeof response[field] !== 'undefined') {
        this[field] = response[field];
      }
    });

    if (response.compression) {
      this.compressor = this.compressors.filter(c => response.compression.indexOf(c) !== -1)[0];
    }
  }
}

module.exports = {
  StreamDescription
};
>>>>>>> d9b5d8d4d7e7782577668ed9860ec566a14c8070
=======
    /* @internal */
    parseServerConnectionID(serverConnectionId) {
        // Connection ids are always integral, so it's safe to coerce doubles as well as
        // any integral type.
        return bson_1.Long.isLong(serverConnectionId)
            ? serverConnectionId.toBigInt()
            : // @ts-expect-error: Doubles are coercible to number
                BigInt(serverConnectionId);
    }
}
exports.StreamDescription = StreamDescription;
//# sourceMappingURL=stream_description.js.map
>>>>>>> 612faa9106d3f31c019c81e2e601cf7d17c60697
